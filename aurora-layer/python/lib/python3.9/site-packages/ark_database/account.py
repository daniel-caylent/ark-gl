import db_main

app_to_db = {
    'accountId': 'uuid',
    'accountNo': 'account_no',
    'parentAccountNo': 'parent_id',
    'accountName': 'name',
    'accountDescription': 'description',
    'attributeNo': 'account_attribute_id',
    'isHidden': 'is_hidden',
    'isTaxable': 'is_taxable',
    'isVendorCustomerPartnerRequired': 'is_vendor_customer_partner_required',
    'FSMappingId': 'fs_mapping_id',
    'FSName': 'fs_name',
    'isDryRun': 'is_dry_run'
}

def insert(db:str, input:dict) -> tuple:
    query = """
        INSERT INTO """+db+""".account
            (uuid, account_no, fund_entity_id, account_attribute_id, parent_id, name, description,
            state, is_hidden, is_taxable, is_vendor_customer_partner_required)
        VALUES
            (%s, %s, %s, %s, %s, %s, %s,
            %s, %s, %s, %s);"""
    
    translated_input = db_main.translate_to_db(app_to_db, input)

    params = (
        translated_input['uuid'],
        translated_input['account_no'],
        translated_input['fund_entity_id'],
        translated_input['account_attribute_id'],
        translated_input['parent_id'],
        translated_input['name'],
        translated_input['description'],
        translated_input['state'],
        translated_input['is_hidden'],
        translated_input['is_taxable'],
        translated_input['is_vendor_customer_partner_required']
    )

    return (query, params)

def update(db:str, id:str, input:dict) -> tuple:
    update_query = """
        UPDATE """+db+""".account
        SET """
    where_clause = "WHERE uuid = %s;"
    
    translated_input = db_main.translate_to_db(app_to_db, input)

    set_clause = ''
    params = ()
    for key in translated_input.keys():
        set_clause += str(key)+" = %s\n"
        params += (translated_input[key],)
    
    params += (id,)

    query = update_query+set_clause+where_clause

    return (query, params)

def delete(db:str, id:str) -> tuple:
    query = """
        DELETE FROM """+db+""".account
        WHERE uuid = %s;"""
    
    params = (id,)

    return (query, params)

def get_by_id(db:str, id:str) -> tuple:
    query = "SELECT * FROM "+db+".account where uuid = %s;"

    params = (id,)

    return (query, params)

def get_by_fund(db:str, fund_id:str) -> tuple:
    query = """
        SELECT acc.*
        FROM """+db+""".account acc
        INNER JOIN """+db+""".fund_entity fe ON (acc.fund_entity_id = fe.id)
        where fe.uuid = %s;"""

    params = (fund_id,)

    return (query, params)

def get_by_name(db:str, account_name:str) -> tuple:
    account_name = account_name.lower().strip()
    query = """
        SELECT *
        FROM """+db+""".account
        where TRIM(LOWER(name)) = %s;"""

    params = (account_name,)

    return (query, params)
